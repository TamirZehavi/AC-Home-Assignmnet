<mat-card class="upload-card">
  <mat-card-header>
    <mat-card-title> File Upload </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <div class="upload-area">
      <input
        #fileInput
        type="file"
        (change)="onFileSelected($event)"
        [disabled]="state.uploading()"
        class="file-input"
        accept=".csv"
      />

      <button
        mat-raised-button
        color="primary"
        (click)="fileInput.click()"
        [disabled]="state.uploading()"
        class="upload-button"
      >
        Choose File
      </button>
    </div>

    @if (state.uploadProgress()) {
      <div class="progress-section">
        <div class="file-info">
          <span class="file-name">{{ state.selectedFile()?.name }}</span>
          <span class="file-size">{{
            formatFileSize(state.selectedFile()?.size || 0)
          }}</span>
        </div>

        <div class="progress-container">
          <mat-progress-bar
            mode="determinate"
            [value]="state.uploadProgress()?.progress"
            [color]="getProgressColor(state.uploadProgress()?.status)"
          ></mat-progress-bar>

          <div class="progress-text">
            @let status = state.uploadProgress()?.status;
            {{ state.uploadProgress()?.progress }}% -
            {{ status ? loadingToStatusText[status] : "" }}
          </div>
        </div>
      </div>
    }

    @if (state.uploadProgress()?.progress === 100) {
      <mat-card class="result-card success">
        <mat-card-content>
          <div class="result-header">
            @let jobStatus = state.jobStatus()?.status;
            <h3>Upload Successful!</h3>
            @if (jobStatus === "loading") {
              <h3>Please stand by for file to download</h3>
            }
            @if (jobStatus === "success") {
              <h3>Downloading</h3>
            }
            @if (jobStatus === "error") {
              <h3>Error downloading the file</h3>
            }
          </div>
          <div class="result-details">
            <p>
              <strong>File:</strong>
              {{ state.selectedFile()?.name }}
            </p>
            <p>
              <strong>Size:</strong>
              {{ formatFileSize(state.selectedFile()?.size || 0) }}
            </p>
            <p>
              <strong>Type:</strong>
              {{ state.selectedFile()?.type }}
            </p>
          </div>
        </mat-card-content>
      </mat-card>
    }

    @if (state.uploadProgress()?.status === "error") {
      <mat-card class="result-card error">
        <mat-card-content>
          <div class="result-header">
            <h3>Upload Failed</h3>
          </div>
        </mat-card-content>
      </mat-card>
    }
  </mat-card-content>
</mat-card>
